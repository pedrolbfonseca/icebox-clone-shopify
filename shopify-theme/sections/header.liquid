{%- liquid
  assign sticky_header = false
  if settings.sticky_header_type == 'always' or settings.sticky_header_type == 'reduce-logo-size'
    assign sticky_header = true
  endif
-%}

<{% if sticky_header %}sticky-header data-sticky-type="{{ settings.sticky_header_type }}"{% else %}div{% endif %} class="header-wrapper">
  <header class="header header--{{ settings.logo_position }} header--mobile-{{ section.settings.mobile_logo_position }}{% if section.settings.menu != blank %} header--has-menu{% endif %}{% if section.settings.enable_country_selector or section.settings.enable_language_selector %} header--has-localizations{% endif %}{% if section.settings.enable_customer_avatar %} header--has-account{% endif %} gradient{% if section.settings.enable_sticky_header %} header--sticky{% endif %}">
    
    {%- if section.settings.announcement_bar_enabled -%}
      <div class="announcement-bar">
        <div class="container">
          <div class="announcement-bar__content">
            <p class="announcement-bar__message">
              {{ section.settings.announcement_text | default: 'Frete grátis em pedidos acima de R$ 500' }}
            </p>
          </div>
        </div>
      </div>
    {%- endif -%}

    <div class="header__inner">
      <div class="container">
        <div class="header__content">
          
          {%- comment -%} Mobile menu button {%- endcomment -%}
          <button type="button" class="header__icon header__icon--menu link focus-inset menu-drawer-toggle" aria-controls="menu-drawer" aria-expanded="false">
            <span class="visually-hidden">{{ 'sections.header.menu' | t }}</span>
            {% render 'icon-hamburger' %}
          </button>

          {%- comment -%} Logo {%- endcomment -%}
          <div class="header__logo">
            {%- if section.settings.logo != blank -%}
              <a href="{{ routes.root_url }}" class="header__logo-link">
                {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
                {%- assign logo_height = section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio -%}
                {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
                {{ section.settings.logo | image_url: width: 600 | image_tag:
                  class: 'header__logo-image',
                  widths: '50, 100, 150, 200, 250, 300, 400, 500, 600',
                  height: logo_height,
                  width: section.settings.logo_width,
                  alt: logo_alt,
                  sizes: sizes,
                  preload: true
                }}
              </a>
            {%- else -%}
              <h1 class="header__logo-text">
                <a href="{{ routes.root_url }}" class="header__logo-link gradient-text">
                  {{ shop.name }}
                </a>
              </h1>
            {%- endif -%}
          </div>

          {%- comment -%} Navigation {%- endcomment -%}
          {%- if section.settings.menu != blank -%}
            <nav class="header__navigation" role="navigation">
              <ul class="header__navigation-list list-unstyled" role="list">
                {%- for link in section.settings.menu.links -%}
                  <li class="header__navigation-item">
                    <a
                      href="{{ link.url }}"
                      class="header__navigation-link link link--text focus-inset"
                      {% if link.current %} aria-current="page"{% endif %}
                    >
                      {{ link.title | escape }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </nav>
          {%- endif -%}

          {%- comment -%} Search {%- endcomment -%}
          {%- if section.settings.enable_search -%}
            <div class="header__search">
              <button type="button" class="header__icon header__icon--search link focus-inset" aria-expanded="false" aria-controls="search-modal">
                <span class="visually-hidden">{{ 'general.search.search' | t }}</span>
                {% render 'icon-search' %}
              </button>
            </div>
          {%- endif -%}

          {%- comment -%} Account {%- endcomment -%}
          <div class="header__icons">
            <a href="{{ routes.account_url }}" class="header__icon header__icon--account link focus-inset">
              <span class="visually-hidden">
                {%- liquid
                  if customer
                    echo 'customer.account_fallback' | t
                  else
                    echo 'customer.log_in' | t
                  endif
                -%}
              </span>
              {% render 'icon-account' %}
            </a>

            {%- comment -%} Cart {%- endcomment -%}
            <a href="{{ routes.cart_url }}" class="header__icon header__icon--cart link focus-inset" id="cart-icon-bubble">
              <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
              {% render 'icon-cart' %}
              {%- if cart != empty -%}
                <div class="cart-count-bubble">
                  {%- if cart.item_count < 100 -%}
                    <span aria-hidden="true">{{ cart.item_count }}</span>
                  {%- endif -%}
                  <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
                </div>
              {%- endif -%}
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>
</{% if sticky_header %}sticky-header{% else %}div{% endif %}>

{%- comment -%} Mobile menu drawer {%- endcomment -%}
<menu-drawer class="drawer" tabindex="-1" id="menu-drawer" data-breakpoint="tablet">
  <div class="drawer__inner">
    <div class="drawer__header">
      <h2 class="drawer__heading">{{ 'sections.header.menu' | t }}</h2>
      <button type="button" class="drawer__close" aria-label="{{ 'accessibility.close' | t }}" data-close>
        {% render 'icon-close' %}
      </button>
    </div>
    <div class="drawer__content">
      {%- if section.settings.menu != blank -%}
        <nav class="mobile-facets__navigation" id="mobile-facets__navigation" role="navigation">
          <ul class="mobile-facets__list" role="list">
            {%- for link in section.settings.menu.links -%}
              <li class="mobile-facets__item">
                <a
                  href="{{ link.url }}"
                  class="mobile-facets__link link link--text focus-inset"
                  {% if link.current %} aria-current="page"{% endif %}
                >
                  {{ link.title | escape }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      {%- endif -%}
    </div>
  </div>
</menu-drawer>

{%- if section.settings.enable_search -%}
  <div class="search-modal modal" id="search-modal" tabindex="-1" role="dialog" aria-labelledby="search-modal-title" aria-modal="true">
    <div class="search-modal__content">
      <div class="search-modal__form-wrapper">
        <form action="{{ routes.search_url }}" method="get" class="search search-modal__form" role="search">
          <div class="field">
            <input
              class="search__input field__input"
              id="search-modal-input"
              type="search"
              name="q"
              value="{{ search.terms | escape }}"
              placeholder="{{ 'general.search.search' | t }}"
              {%- if settings.predictive_search_enabled -%}
                role="combobox"
                aria-expanded="false"
                aria-owns="predictive-search-results"
                aria-autocomplete="list"
                aria-describedby="predictive-search-live-region"
                autocorrect="off"
                autocomplete="off"
                autocapitalize="off"
                spellcheck="false"
              {%- endif -%}
            >
            <label class="field__label" for="search-modal-input">{{ 'general.search.search' | t }}</label>
            <button type="submit" class="search__button field__button" aria-label="{{ 'general.search.search' | t }}">
              {% render 'icon-search' %}
            </button>
          </div>

          {%- if settings.predictive_search_enabled -%}
            <div class="predictive-search predictive-search--header" tabindex="-1" data-predictive-search>
              <div class="predictive-search__loading-state">
                {% render 'icon-loading' %}
              </div>
            </div>

            <span class="predictive-search-live-region visually-hidden" id="predictive-search-live-region" role="status" aria-polite="polite"></span>
          {%- endif -%}
        </form>
        
        <button type="button" class="search-modal__close-button modal__close-button link link--text focus-inset" aria-label="{{ 'accessibility.close' | t }}">
          {% render 'icon-close' %}
        </button>
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "announcement_bar_enabled",
      "default": true,
      "label": "t:sections.header.settings.announcement_bar_enabled.label"
    },
    {
      "type": "text",
      "id": "announcement_text",
      "default": "Frete grátis em pedidos acima de R$ 500",
      "label": "t:sections.header.settings.announcement_text.label"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:sections.header.settings.logo.label"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "t:sections.header.settings.logo_width.label"
    },
    {
      "type": "select",
      "id": "logo_position",
      "options": [
        {
          "value": "top-left",
          "label": "t:sections.header.settings.logo_position.options__2.label"
        },
        {
          "value": "top-center",
          "label": "t:sections.header.settings.logo_position.options__3.label"
        },
        {
          "value": "middle-left",
          "label": "t:sections.header.settings.logo_position.options__1.label"
        },
        {
          "value": "middle-center",
          "label": "t:sections.header.settings.logo_position.options__4.label"
        }
      ],
      "default": "middle-left",
      "label": "t:sections.header.settings.logo_position.label"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
    {
      "type": "select",
      "id": "mobile_logo_position",
      "options": [
        {
          "value": "center",
          "label": "t:sections.header.settings.mobile_logo_position.options__1.label"
        },
        {
          "value": "left",
          "label": "t:sections.header.settings.mobile_logo_position.options__2.label"
        }
      ],
      "default": "center",
      "label": "t:sections.header.settings.mobile_logo_position.label"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "t:sections.header.settings.enable_search.label"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_avatar",
      "default": true,
      "label": "t:sections.header.settings.enable_customer_avatar.label",
      "info": "t:sections.header.settings.enable_customer_avatar.info"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__3.content"
    },
    {
      "type": "checkbox",
      "id": "enable_country_selector",
      "default": true,
      "label": "t:sections.header.settings.enable_country_selector.label",
      "info": "t:sections.header.settings.enable_country_selector.info"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__4.content"
    },
    {
      "type": "checkbox",
      "id": "enable_language_selector",
      "default": true,
      "label": "t:sections.header.settings.enable_language_selector.label",
      "info": "t:sections.header.settings.enable_language_selector.info"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.mobile_layout.content"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "t:sections.header.settings.enable_sticky_header.label",
      "info": "t:sections.header.settings.enable_sticky_header.info"
    }
  ]
}
{% endschema %}